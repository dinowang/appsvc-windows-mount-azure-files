# UserUpload - ASP.NET Core File Upload Application

A simple ASP.NET Core web application that allows users to upload files with Azure deployment support.

## Features

- **File Upload**: Multi-file upload functionality through a web interface
- **Azure Integration**: Ready for deployment to Azure App Service
- **Persistent Storage**: Azure File Share integration for storing uploaded files
- **Responsive UI**: Bootstrap-based responsive design

> ðŸ’¡ **Quick Navigation**: See [STRUCTURE.md](STRUCTURE.md) for a complete project structure reference and common commands.

## Project Structure

```
UserUpload/
â”œâ”€â”€ doc/                      # Documentation
â”‚   â”œâ”€â”€ DEPLOYMENT.md         # Deployment guide
â”‚   â””â”€â”€ PROJECT_SUMMARY.md    # Project summary
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ aspnet/               # ASP.NET Core Application
â”‚   â”‚   â”œâ”€â”€ Pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Upload.cshtml          # File upload page
â”‚   â”‚   â”‚   â”œâ”€â”€ Upload.cshtml.cs       # File upload logic
â”‚   â”‚   â”‚   â”œâ”€â”€ Index.cshtml           # Home page
â”‚   â”‚   â”‚   â””â”€â”€ Shared/
â”‚   â”‚   â”‚       â””â”€â”€ _Layout.cshtml     # Layout template
â”‚   â”‚   â”œâ”€â”€ wwwroot/                   # Static files
â”‚   â”‚   â”œâ”€â”€ Program.cs                 # Application entry point
â”‚   â”‚   â””â”€â”€ UserUpload.csproj          # Project file
â”‚   â””â”€â”€ terraform/            # Infrastructure as Code
â”‚       â”œâ”€â”€ main.tf           # Main Terraform configuration
â”‚       â”œâ”€â”€ variables.tf      # Variable definitions
â”‚       â”œâ”€â”€ outputs.tf        # Output definitions
â”‚       â”œâ”€â”€ README.md         # Terraform documentation
â”‚       â””â”€â”€ RANDOM_SUFFIX.md  # Random suffix guide
â””â”€â”€ README.md                 # This file
```

## Running Locally

### Prerequisites

- .NET 9.0 SDK or later

### Steps

1. Navigate to the application directory:
```bash
cd src/aspnet
```

2. Run the application:
```bash
dotnet run
```

3. Open your browser and navigate to `https://localhost:5001` or `http://localhost:5000`

4. Click on "Upload" in the navigation menu to access the file upload page

## Deploying to Azure

### Automated Deployment with Terraform

Terraform will automatically build, package, and deploy your application:

1. Navigate to the terraform directory:
```bash
cd src/terraform
```

2. Initialize Terraform:
```bash
terraform init
```

3. Deploy infrastructure and application (automated build & zip deployment):
```bash
terraform apply
```

**What happens automatically:**
- âœ… Builds the ASP.NET Core application
- âœ… Creates a deployment zip package
- âœ… Provisions Azure infrastructure
- âœ… Deploys the application to App Service

4. Get the application URL:
```bash
terraform output app_service_url
```

### Manual Deployment (Alternative)

If you prefer to deploy manually using Azure CLI:

```bash
# Build and package
cd src/aspnet
dotnet publish -c Release -o ../../publish
cd ../../publish
zip -r ../app.zip .
cd ..

# Deploy
RESOURCE_GROUP=$(cd src/terraform && terraform output -raw resource_group_name)
APP_SERVICE=$(cd src/terraform && terraform output -raw app_service_name)

az webapp deployment source config-zip \
  --resource-group $RESOURCE_GROUP \
  --name $APP_SERVICE \
  --src app.zip
```

## Configuration

### Upload Directory

By default, files are uploaded to an `uploads` directory in the application root. When deployed to Azure with the Terraform configuration, the Azure File Share is mounted at `/mounts/uploads` for persistent storage.

### Application Settings

Configure the upload path in `appsettings.json` if needed:

```json
{
  "UploadSettings": {
    "Path": "/mounts/uploads"
  }
}
```

## Azure Resources

The Terraform configuration provisions (all resources share a random 6-character hex suffix):

- **Azure App Service Plan** (P0v3, Windows) - `plan-userupload-XXXXXX`
- **Azure App Service** (Windows Web App) - `web-userupload-XXXXXX`
- **Storage Account** with Azure Files - `storuseruploadXXXXXX`
- **Azure File Share** (mounted to App Service) - `userupload-files`

The random suffix ensures global uniqueness and is automatically generated by Terraform. 

**Note**: This configuration uses local Terraform state storage. See `src/terraform/STATE_MANAGEMENT.md` for important information about state management and backups. For detailed infrastructure documentation, see `src/terraform/README.md`.

## Security Considerations

- Implement file type validation
- Set maximum file size limits
- Scan uploaded files for malware
- Use authentication/authorization for production deployments
- Enable HTTPS only in production

## License

MIT License
